---
title: "Tarea 02. Muestreo por Conglomerados"
author: "LMT"
date: "mayo de 2022"
output: html_document
---

**Fecha de entrega**

Fecha límite de entrega: jueves 12 de mayo de 2022 a las 8:00 pm.

Enviar solución con resultados y comentarios al Classroom de la clase.


Los datos para la tarea se encuentran en la carpeta compartida en drive correspondiente a [datos](https://drive.google.com/drive/folders/1jlAoKUdLXeywxdNxXlLms9Bg_Vp7G98e?usp=sharing).

### Ejercicio 1

Utilizar los datos del Censo de 2010 de Tlaxcala (la tabla de viviendas). Considerar que tienen presupuesto para una muestra de tamaño 60,000. Utilizar la variable de localidad como variable de conglomerado (cluster). Bajo el supuesto de que sea el mismo costo levantar una encuesta en cada conglomerado, obtener una muestra en 2 etapas de k conglomerados y ‘mi’ elementos dentro de cada conglomerado. Hagan pruebas con los valores de los parámetros k y ‘mi’ con los que obtengan una estimación razonable para el número promedio de cuartos. 


Modiicar los parámetros


### Ejercicio 2


Encuesta económica.


Dado quelos datos que tienen están agrupado, el promedio se puede estimar como la razón del total de gasto entre elnúmero de hogares Mi los totales. (¿les hace sentido?) 



### Tamaño de muestra

```{r}
# Limpiar área de trabajo
rm(list = ls())
```


```{r}
# Cargar librerías
suppressMessages(library(tidyverse))
library(readr)
```

Breve descripción de los datos

* El diseño utilizado en muestreo estratificado. 
* Se seleccionó una muestra de 7,200 casillas repartida en 300 estratos.
* La tabla muestra_2006.csv contiene el identificador de casilla, identificador de la entidad federativa, el número de votos que recibió cada partido o coalición, el total de votos registrados en la casilla y el estrato. Nota. La columna otros contine el número de votos nulos y votos de candidatos no registrados.
* la tabla estratos.csv contiene el número total de casillas en el estrato (columna Nh) y el número de casillas que se seleccionaron en la muestra (nh)


Leer los datos

```{r}
muestra_2006 <- read_csv("/home/leonardo/Documentos/Acatlan/Datos/CONTEO_RAPIDO_2006/muestra_2006.csv")
glimpse(muestra_2006)
```


```{r}
estratos <- read_csv("/home/leonardo/Documentos/Acatlan/Datos/CONTEO_RAPIDO_2006/estratos.csv")
glimpse(estratos)
```

Unir la información de las tablas

```{r}
datos_elecciones <-  left_join(muestra_2006,estratos, by = c("estrato")) %>% 
                      mutate(fh = Nh/nh, # se creó la variable factor de expansión de cada estrato
                             fpc = nh/Nh)  %>% 
                      arrange(estrato, casilla_id)

glimpse(datos_elecciones)

```

**Ejercicio**. La información con la que cuentan ya es una muestra, deben realizar las siguientes estimaciones. 

Para cada partido obtener:

* Estimación del total de votos.
* Error estándar.
* Intervalo de confianza al 90%.

Mostrar los resultados en una tabla ordenados de forma descendiente por la columna de estimación. 

Adicionalmente expresar textualmente sus resultados. Ejemplo: "El total de votos para el partido x es de xxx,xxx votos. El verdadero parámetro se encuentra entre xxx,xxx y xxx,xxx, con un 90% de confianza." o "Se tiene un 90% de confianza de que el total de votos del partido x se encuentra entre xxx,xxx y xxx,xxx."




Nota, si requieren hacer copy-paste de código más de 3 veces consideren la opción de crear una función. 


### Ejercicio 2

Los datos a utilizar para este ejercicio corresponden a canciones de spotify entre 2000 y 2020. Considerar esta base como su marco muestral. 

Breve descripción de algunas variables de los datos.

**númericas**:

* acousticness: The relative metric of the track being acoustic, (Ranges from 0 to 1).
* danceability: The relative measurement of the track being danceable, (Ranges from 0 to 1).
* duration_ms: The length of the track in milliseconds (ms), (Integer typically ranging from 200k to 300k).
* duration_minutes: The length of the track in minutes.
* energy: The energy of the track, (Ranges from 0 to 1).
* instrumentalness:, The relative ratio of the track being instrumental, (Ranges from 0 to 1) valence: The positiveness of the track, (Ranges from 0 to 1).
* liveness: The relative duration of the track sounding as a live performance, (Ranges from 0 to 1).
* loudness: Relative loudness of the track in decibel (dB), (Float typically ranging from -60 to 0). 
* popularity: The popularity of the song lately, default country = US, (Ranges from 0 to 100).
* tempo:The tempo of the track in Beat Per Minute (BPM), (Float typically ranging from 50 to 150)    
* speechiness: The relative length of the track containing any kind of human voice, (Ranges from 0 to 1).
* year: The release year of track, (Ranges from 2000 to 2020)
    
    
**categoricas**

* id, The primary identifier for the track, generated by Spotify.
* key: The primary key of the track encoded as integers in between 0 and 11 (starting on C as 0, C# as 1 and so on…).
* artists: The list of artists credited for production of the track
* release_date: Date of release mostly in yyyy-mm-dd format, however precision of date may vary
*mode: The binary value representing whether the track starts with a major (1) chord progression or a minor (0).
* name: The title of the track.
* explicit: The binary value whether the track contains explicit content or not, (0 = No explicit content, 1 = Explicit content).

---

Leer los datos

```{r}
# Limpiar área de trabajo
rm(list = ls())
```


```{r}
# Cargar librerías
suppressMessages(library(tidyverse))
suppressMessages(library(arrow))
```


```{r}
spotify <- arrow::read_feather("/home/leonardo/Documentos/Acatlan/Datos/spotify/spotify_artistas.feather")
glimpse(spotify)
```

Generar una muestra estratificada por la variable artistas. Utilizar una muestra de 300 canciones. Incluir en la muestra al menos 1 registro por artista.

**ejercicio**. Calcular:

* a) La estimación de la duración del tiempo promedio en minutos de las canciones.
* b) El intervalo de confianza correspondiente al 95%.
* c) Utilizando la estimación del inciso a) ¿Cuántas canciones necesitaria una playlist para un viaje de 3 hrs?.

`En provincia le llaman roadtrip a un viaje de 3 hrs, en la cdmx le llaman tengo junta en Santa Fe.`

(opcional). Hagan uso de la variabilidad obtenida en la pregunta anterior para generar una gráfica del tamañode muestra vs precisión (margen de error). ¿Qué margen de error utilizarian? ¿Qué tamaño de muestra necesitan para la precisión elegida?.

### Ejercicio 3

Los datos a utilizar para este ejercicio corresponden población sin derechohabiencia del IMSS o ISSSTE.

En un estudio para estimar el total de la población a nivel nacional que no tiene servicios de salud como asalariado (IMSS o ISSSTE), se tomó una muestra de 246 municipios, utilizando el grado de nivel socioeconómico como estrato de muestreo. Se supone que el nivel de marginación se relaciona con la proporción de personas con derechohabiencia, por lo que la estratificación debe ayudar a reducir la varianza del estimador.

Los datos muestrales se presentan en la siguiente tabla:


![tabla](/home/leonardo/Documentos/Acatlan/muestreo_2022/imágenes/tabla_derechohabiencia.png)

La tabla se encuentra dentro de la subcarpeta derechohabiencia en la carpeta de datos de la clase.

**ejercicio**.

* Estimar total de personas sin derechohabiencia a nivel nacional usando la información estratificada que aparece en la tabla. 
* Construir un intervalo de confianza al 95%. 
* Se observa que hay estratos con mayor variabilidad que otros. Realizar una asignación por el método de Neyman para cada estrato. Considerar que el tamaño total de la muestra es 250.











